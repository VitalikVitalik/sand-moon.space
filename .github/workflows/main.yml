name: scp files
on: [push]
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: copy file via ssh password
      uses: appleboy/scp-action@master
      with:
        host: sand-moon.space
        username: root  
        password: ${{ secrets.CENTOSSSH }}
        port: 3332
        source: "*"
        target: "/usr/share/nginx/"
        
    - name: executing remote ssh commands using password
      uses: appleboy/ssh-action@master
      with:
        host: sand-moon.space
        username: root
        password: ${{ secrets.CENTOSSSH }}
        port: 3332
        script: |
         cp /usr/share/nginx/nginx-template.conf /etc/nginx/conf.d/${{ github.event.head_commit.message }}.conf
         chmod 777 /etc/nginx/conf.d/"${{ github.event.head_commit.message }}".conf
         chmod 777 /usr/share/nginx/*
         sed -i 'server_name  $path;' 'server_name ${{ github.event.head_commit.message }}'
         sed -i 'root         /usr/share/nginx/sand-moon.space/$sitepath/;' 'root         /usr/share/nginx/sand-moon.space/$sitepath/${{ github.event.head_commit.message }}' 
         systemctl restart nginx
